# Basic Confginguration

## Webswing files
Webswing distribution contains several files, but only three of them are necessary to run webswing.

![files.png](https://bitbucket.org/repo/or95po/images/253758333-files.png)

1. `webswing-server.war` file is the main executable file. This file is a regular web application file with embeded jetty server.

2. `webswing.config` file contains the configuration of swing applications. Swing application's class-path, main class, arguments and permissions are described in this file. See more details in "Swing application configuration" section.

3. `user.properties` contains the users, passwords and authorization roles. This file is necessary unless you configure your own application security realm in `shiro.ini`. (See Development guide)

4. (optional)`jetty.properties` is a convenient option of configuring the built-in jetty server. Each setting can be overridden with command-line option. For more details refer to 'Server start-up parameters' section

**Webswing generates following output files:**

`tmp` folder is created for extracting client libraries and temporary files generated by application print or file download functionality. Path for this temporary folder can be changed by defining comman-line option -t `<path>` . By default `tmp` folder contents are wiped when Webswing starts. If `-d true` is set, a time-stamped folder inside `tmp` is created every time Webswing server is started.

`webswing.log` file for storing Webswing server and swing application instance logs.

`webswing.config.backup` the webswing.config file content is backed up to this file after this config is changed in administration console. By default last 10 version are kept in this file.

#Server start-up parameters

Start scripts `start.bat` and `start.sh` are included in Webswing distribution. These scripts may need to be adapted to point to the right java installation and to configure other custom options. You can define following options in start scripts (default values in parenthesis):
```
c:\webswing-2.2>java -jar webswing-server.war -h
usage: webswing
 -c,--config <arg>           Configuration file name.
                             (<webswing-server.war path>/webswing.config)
 -d <arg>                    Create new temp folder for every webswing
                             instance (false)
 -h,--host <arg>             Local interface address where the web server
                             will listen. (localhost)
 -j,--jetty <arg>            Jetty startup configuration file.
                             (./jetty.properties)
 -kp,--keystorepwd <arg>     Keystore password
 -ks,--keystore <arg>        Keystore file location for ssl configuration
 -p,--port <arg>             Http port where the web server will listen.
                             If 0 http is disabled. (8080)
 -s,--sslport <arg>          Https port where the web server will listen.
                             If 0 http is disabled. (0)
 -t,--temp <arg>             The folder where temp folder will be created
                             for the webswing server. (./tmp)
 -tp,--truststorepwd <arg>   Truststore password
 -ts,--truststore <arg>      Truststore file location for ssl
                             configuration
 -u,--users <arg>            Users properties file name.
                             (<webswing-server.war path>/users.properties)
```

Since version 2.2, there is a configuration file for the built-in jetty called `jetty.properties`. It is used to configure connection options of the server like ports, protocols, SSL certificates and CORS origins (for embedded Webswing ). Command-line options have higher priority than this file. You can configure following options: 

```properties
org.webswing.server.host=localhost

org.webswing.server.http=true
org.webswing.server.http.port=8080

org.webswing.server.https=true
org.webswing.server.https.port=8443
org.webswing.server.https.truststore=ssl/truststore.jks
org.webswing.server.https.truststore.password=123123
org.webswing.server.https.keystore=ssl/keystore.jks
org.webswing.server.https.keystore.password=123123

#comma separated urls
org.webswing.server.allowedCorsOrigins=*
```

#Swing application configuration

Swing applications are configured in json format and by default saved in file `webswing.config`, which is by default placed in the same folder as the `webswing-server.war` file. This location may be changed using the `-c` command-line option. It is recommended to use Administration console's form based configuration screen to modify this file to avoid json formatting problems.

This is a sample `webswing.config` file content with sample swing application configured:
```json
{
  "applications" : [{
    "name" : "SwingSet3",
    "icon" : "icon.png",
    "mainClass" : "com.sun.swingset3.SwingSet3",
    "classPathEntries" : [ "SwingSet3.jar", "lib/*.jar" ],
    "vmArgs" : "-Xmx128m",
    "args" : "",
    "homeDir" : "demo/SwingSet3",
    "maxClients" : 1,
    "antiAliasText" : true,
    "swingSessionTimeout" : 300,
    "authorization" : false,
    "isolatedFs" : true,
    "debug" : false,
    "authentication" : false,
    "directdraw" : false,
    "allowDelete" : true,
    "allowDownload" : true,
    "allowUpload" : true
  }]
}
```
Since version 2.2 it is possible to use wildcards in `classPathEntries`. Supported wildcards are `*` (everything) and `?` (any singe character). 

`name`: Swing application name. Will be displayed in application selection screen.

`icon`: Path to icon displayed in application selection dialog. Absolute path or path relative to 'homeDir'

`mainClass`: Swing application fully qualified class name. (ie. 'com.mypackage.Main')

`classPathEntries`: Swing application's classpath. Absolute or relative path to jar file or classes directory. At least one classPath entry should be specified containing the main class. Allows using `?` (any single char) and `*` (everything) wildcards.

`vmArgs`: Commandline arguments processed by Oracle's Java Virtual Machine. (ie. '-Xmx128m')

`args`: Swing application main method arguments. This string will be passed to the main method's (String[] args)

`homeDir`: Swing application's home directory. Swing application instances will be executed from this directory. This will also be the base directory of any relative classpath entries specified.

`maxClients`: Maximum number of allowed simultaneous connections for this application.

`antiAliasText`: Enables rendering of anti-aliased text. Smoothens the edges of the text.

`swingSessionTimeout`: Specifies how long (seconds) will be the swing application left running after the user closes the browser. User can reconnect in this interval and continue in last session.

`authorization`: Set authorized access to this application. Only users with role same as application's name can access this application.

`isolatedFs`: If enabled, this setting will force the JFileChooser to stay inside isolated folder. The new isolated folder is created in `{homeDir}/upload` 

`debug`: Enables remote debug for this application. After the application is started from browser, it will wait for remote debugger connection on port 8000

New in version 2.2:

`authentication`: If set to false, the application will be accessible for anonymous user. If true only authenticated user is allowed to use this application. False setting will be ignored if 'authorization' option is true.

`directdraw`: Activates the new rendering method if the clients browser supports the required technologies (typed arrays, web socket). This feature is experimental state at the moment. For more information on this method refer to Development guide. 

`allowDelete`: This options activates the 'Delete' button on the JFileChooser integration panel. If this is true, user will be allowed to delete files displayed in JFileChooser dialog.

`allowDownload`: This options activates the 'Download' button on the JFileChooser integration panel. If this is true, user will be allowed to download files displayed in JFileChooser dialog.

`allowUpload`: This options activates the 'Upload' button and drop area on the JFileChooser integration panel. If this is true, user will be allowed to upload files to folder displayed in JFileChooser dialog.


#Authentication setup
Webswing uses Apache Shiro framework for authentication and authorization. By default, the users are configured in simple properties file called `user.properties`, which is expected to be in the same folder as the `webswing-server.war` file. Location of this file could be changed using the `-u` command-line option.

This is the sample content of `user.properties` file:
```properties
#user.=[,role1][,role2]...
user.admin=pwd,admin
user.user=pwd,Printing
user.guest=guest
```
First line is a comment describing the format. Each user entry starts with prefix `user.`, followed by the actual user name. Password is specified after the equals sign. After the password comes comma separated list of roles for specifying the list of authorized applications. Role `admin` enables access to Administration console and implicit access to all applications. Role `Printing` refers to swing application name from `webswing.config` file.

Shiro framework offers also other methods of authentication like Ldap, Database or Active Directory. This could be configured in `shiro.ini` file which is located in the `webswing-server.war` archive in `WEB-INF` folder. Security manager realm implementation class name `org.webswing.server.util.WebSwingPropertiesRealm` has to be changed to one of the standard Shiro's implementations or your own custom. 
See:
* org.apache.shiro.realm.ldap.JndiLdapRealm 
* org.apache.shiro.realm.activedirectory.ActiveDirectoryRealm 
* org.apache.shiro.realm.jdbc.JdbcRealm
```properties
[main]
authc=org.apache.shiro.web.filter.authc.PassThruAuthenticationFilter
authc.loginUrl = /login

webswingUserProps=org.webswing.server.util.WebSwingPropertiesRealm
securityManager.realm = $webswingUserProps

[urls]
/async/admin/** = authc, roles[admin]
/async/swing = authc
/file = authc
/upload = authc
/logout = logout
/** = anon 
```
For detailed information please refer to Shiro documentation or if you need help with configuration please contact us.


#Accessing Webswing application
When you start the webswing server with default settings, it will start on URL `http://localhost:8080` . The webpage served on this URL will ask for credentials and then show the list of swing application available for logged in user. This default behavior of the page can be modified to certain extent using URL parameters. 

Following parameters are recognized:

`http://localhost:8080?app=<name>` : for selecting the application to run. If this parameter is specified, dialog with list of swing applications will be skipped. `<name>` is the swing application name as specified in `webswing.config` file.

`http://localhost:8080?args=arg1,arg2` : for specifying additional arguments for the swing application. Value of this parameter will be appended to value specified in `args` option of `webswing.config` file.

`http://localhost:8080?anonym=true` : tells the server to authenticate the application with anonymous user. This user has access only to applications with `authentication` and `authorization` set to `false` in `webswing.config` file. 

URL parameters can be combined together.

If your deployment has other specific requirements which are not achievable by this set of parameters, you can embed Webswing's javascript snippet to your own web page, where you have full control and ability to further customize the behavior. Additional details about embedding can be found at Advanced configuration page

#Using the Admin console
Admin console is located on URL `http://localhost:8080/admin` and only users with `admin` role are allowed to access it. Admin console can help you with:

* Monitoring running swing sessions
* Accessing mirror view function, useful to support the swing application. It lets you take control of application and help users with problems.
* View runtime configuration information including deployed applications
* Lets you change the configuration without server restart. You can add, remove or modify deployed applications in form based and text based mode.
* Lets you change the users configuration file and apply changes without server restart.